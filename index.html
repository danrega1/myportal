<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delegation & Team Growth Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    
    // Icon components using Lucide
    const Icon = ({ name, className = "w-5 h-5" }) => {
      const ref = React.useRef(null);
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          icon.setAttribute('class', className);
          ref.current.appendChild(icon);
        }
      }, [name, className]);
      return <span ref={ref} className="inline-flex items-center justify-center" />;
    };

    const GIST_FILENAME = 'delegation-portal-data.json';

    function DelegationPortal() {
      // Auth & Sync State
      const [token, setToken] = useState('');
      const [tokenInput, setTokenInput] = useState('');
      const [gistId, setGistId] = useState('');
      const [isSetup, setIsSetup] = useState(false);
      const [syncStatus, setSyncStatus] = useState('idle');
      const [syncMessage, setSyncMessage] = useState('');
      const [lastSynced, setLastSynced] = useState(null);
      const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);
      const [showSettings, setShowSettings] = useState(false);

      // App State
      const [activeTab, setActiveTab] = useState('dashboard');
      const [currentQuarter, setCurrentQuarter] = useState('Q1');
      
      const [weeklyReflection, setWeeklyReflection] = useState({
        delegated: '',
        shouldHaveDelegated: '',
        whoStretched: '',
        needsChallenge: '',
        askedOrAnswered: ''
      });
      
      const [delegationLog, setDelegationLog] = useState([]);
      const [newDelegation, setNewDelegation] = useState({ task: '', person: '', level: '2', date: new Date().toISOString().split('T')[0] });
      
      const [teamMembers, setTeamMembers] = useState([
        { id: 1, name: 'Team Member 1', stretchProject: '', delegationLevel: 2, notes: '' },
        { id: 2, name: 'Team Member 2', stretchProject: '', delegationLevel: 2, notes: '' },
      ]);
      
      const defaultChecklist = {
        Q1: { items: [
          { id: 1, text: 'Create Delegation Inventory', done: false },
          { id: 2, text: 'Identify stretch project for each team member', done: false },
          { id: 3, text: 'Implement 5-minute rule', done: false },
          { id: 4, text: 'Start delegation conversations in 1:1s', done: false },
        ]},
        Q2: { items: [
          { id: 1, text: 'Assign ownership (not tasks) to 2+ team members', done: false },
          { id: 2, text: 'Practice coaching questions instead of answers', done: false },
          { id: 3, text: 'Establish review checkpoints for delegated projects', done: false },
          { id: 4, text: 'Have team members document their decisions', done: false },
        ]},
        Q3: { items: [
          { id: 1, text: 'Delegate a visible initiative to a team member', done: false },
          { id: 2, text: 'Have each team member lead a knowledge-sharing session', done: false },
          { id: 3, text: 'Step back from daily decisions in delegated areas', done: false },
          { id: 4, text: 'Ask team members what they can do now vs 6 months ago', done: false },
        ]},
        Q4: { items: [
          { id: 1, text: 'Share delegation progress with John', done: false },
          { id: 2, text: 'Gather team feedback on ownership and challenge', done: false },
          { id: 3, text: 'Plan next-level delegation for next year', done: false },
          { id: 4, text: 'Publicly recognize team member stretch accomplishments', done: false },
        ]},
      };
      
      const [quarterlyChecklist, setQuarterlyChecklist] = useState(defaultChecklist);
      const [impulseCounter, setImpulseCounter] = useState({ caught: 0, redirected: 0 });
      const [savedReflections, setSavedReflections] = useState([]);

      // Load token and gistId from localStorage on mount
      useEffect(() => {
        const savedToken = localStorage.getItem('github_token');
        const savedGistId = localStorage.getItem('gist_id');
        if (savedToken) {
          setToken(savedToken);
          setIsSetup(true);
        }
        if (savedGistId) {
          setGistId(savedGistId);
        }
      }, []);

      // Mark unsaved changes when data changes
      const [initialLoadDone, setInitialLoadDone] = useState(false);
      useEffect(() => {
        if (initialLoadDone && isSetup) {
          setHasUnsavedChanges(true);
        }
      }, [delegationLog, teamMembers, quarterlyChecklist, impulseCounter, savedReflections]);

      // Gather all data into one object
      const gatherData = useCallback(() => {
        return {
          delegationLog,
          teamMembers,
          quarterlyChecklist,
          impulseCounter,
          savedReflections,
          lastUpdated: new Date().toISOString()
        };
      }, [delegationLog, teamMembers, quarterlyChecklist, impulseCounter, savedReflections]);

      // Apply loaded data to state
      const applyData = (data) => {
        if (data.delegationLog) setDelegationLog(data.delegationLog);
        if (data.teamMembers) setTeamMembers(data.teamMembers);
        if (data.quarterlyChecklist) setQuarterlyChecklist(data.quarterlyChecklist);
        if (data.impulseCounter) setImpulseCounter(data.impulseCounter);
        if (data.savedReflections) setSavedReflections(data.savedReflections);
      };

      // GitHub Gist API Functions
      const createGist = async (authToken) => {
        const response = await fetch('https://api.github.com/gists', {
          method: 'POST',
          headers: {
            'Authorization': `token ${authToken}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            description: 'Delegation Portal Data - Auto-generated',
            public: false,
            files: {
              [GIST_FILENAME]: {
                content: JSON.stringify(gatherData(), null, 2)
              }
            }
          })
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Failed to create Gist');
        }
        
        const gist = await response.json();
        return gist.id;
      };

      const updateGist = async (gistIdToUpdate, authToken) => {
        const response = await fetch(`https://api.github.com/gists/${gistIdToUpdate}`, {
          method: 'PATCH',
          headers: {
            'Authorization': `token ${authToken}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            files: {
              [GIST_FILENAME]: {
                content: JSON.stringify(gatherData(), null, 2)
              }
            }
          })
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Failed to update Gist');
        }
        
        return await response.json();
      };

      const fetchGist = async (gistIdToFetch, authToken) => {
        const response = await fetch(`https://api.github.com/gists/${gistIdToFetch}`, {
          headers: {
            'Authorization': `token ${authToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (!response.ok) {
          if (response.status === 404) {
            return null;
          }
          const error = await response.json();
          throw new Error(error.message || 'Failed to fetch Gist');
        }
        
        const gist = await response.json();
        const file = gist.files[GIST_FILENAME];
        if (file) {
          return JSON.parse(file.content);
        }
        return null;
      };

      const findExistingGist = async (authToken) => {
        const response = await fetch('https://api.github.com/gists', {
          headers: {
            'Authorization': `token ${authToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (!response.ok) {
          return null;
        }
        
        const gists = await response.json();
        const existingGist = gists.find(g => g.files && g.files[GIST_FILENAME]);
        return existingGist ? existingGist.id : null;
      };

      // Save to Cloud
      const saveToCloud = async () => {
        setSyncStatus('saving');
        setSyncMessage('Saving to GitHub...');
        
        try {
          let currentGistId = gistId;
          
          if (!currentGistId) {
            currentGistId = await createGist(token);
            setGistId(currentGistId);
            localStorage.setItem('gist_id', currentGistId);
          } else {
            await updateGist(currentGistId, token);
          }
          
          setSyncStatus('success');
          setSyncMessage('Saved successfully!');
          setLastSynced(new Date());
          setHasUnsavedChanges(false);
          
          setTimeout(() => setSyncStatus('idle'), 2000);
        } catch (error) {
          setSyncStatus('error');
          setSyncMessage(`Error: ${error.message}`);
          setTimeout(() => setSyncStatus('idle'), 3000);
        }
      };

      // Load from Cloud
      const loadFromCloud = async () => {
        setSyncStatus('loading');
        setSyncMessage('Loading from GitHub...');
        
        try {
          let currentGistId = gistId;
          
          if (!currentGistId) {
            currentGistId = await findExistingGist(token);
            if (currentGistId) {
              setGistId(currentGistId);
              localStorage.setItem('gist_id', currentGistId);
            }
          }
          
          if (!currentGistId) {
            setSyncStatus('error');
            setSyncMessage('No cloud data found. Save first to create.');
            setTimeout(() => setSyncStatus('idle'), 3000);
            return;
          }
          
          const data = await fetchGist(currentGistId, token);
          
          if (data) {
            applyData(data);
            setSyncStatus('success');
            setSyncMessage('Loaded successfully!');
            setLastSynced(new Date());
            setHasUnsavedChanges(false);
            setInitialLoadDone(true);
          } else {
            setSyncStatus('error');
            setSyncMessage('No data found in Gist');
          }
          
          setTimeout(() => setSyncStatus('idle'), 2000);
        } catch (error) {
          setSyncStatus('error');
          setSyncMessage(`Error: ${error.message}`);
          setTimeout(() => setSyncStatus('idle'), 3000);
        }
      };

      // Setup: Save token
      const handleSetupSubmit = async () => {
        if (tokenInput.trim()) {
          const trimmedToken = tokenInput.trim();
          
          // Verify token works
          setSyncStatus('loading');
          setSyncMessage('Verifying token...');
          
          try {
            const response = await fetch('https://api.github.com/user', {
              headers: {
                'Authorization': `token ${trimmedToken}`,
                'Accept': 'application/vnd.github.v3+json'
              }
            });
            
            if (!response.ok) {
              throw new Error('Invalid token');
            }
            
            localStorage.setItem('github_token', trimmedToken);
            setToken(trimmedToken);
            setIsSetup(true);
            setInitialLoadDone(true);
            setSyncStatus('idle');
            
            // Check for existing gist
            const existingGistId = await findExistingGist(trimmedToken);
            if (existingGistId) {
              setGistId(existingGistId);
              localStorage.setItem('gist_id', existingGistId);
            }
          } catch (error) {
            setSyncStatus('error');
            setSyncMessage('Invalid token. Please check and try again.');
            setTimeout(() => setSyncStatus('idle'), 3000);
          }
        }
      };

      // Clear setup
      const handleClearSetup = () => {
        localStorage.removeItem('github_token');
        localStorage.removeItem('gist_id');
        setToken('');
        setGistId('');
        setIsSetup(false);
        setShowSettings(false);
      };

      // App Functions
      const toggleChecklistItem = (quarter, itemId) => {
        setQuarterlyChecklist(prev => ({
          ...prev,
          [quarter]: {
            ...prev[quarter],
            items: prev[quarter].items.map(item =>
              item.id === itemId ? { ...item, done: !item.done } : item
            )
          }
        }));
      };

      const addDelegation = () => {
        if (newDelegation.task && newDelegation.person) {
          setDelegationLog(prev => [...prev, { ...newDelegation, id: Date.now() }]);
          setNewDelegation({ task: '', person: '', level: '2', date: new Date().toISOString().split('T')[0] });
        }
      };

      const saveWeeklyReflection = () => {
        const reflection = {
          ...weeklyReflection,
          id: Date.now(),
          date: new Date().toISOString().split('T')[0],
          week: `Week ${Math.ceil((new Date().getDate()) / 7)}`
        };
        setSavedReflections(prev => [reflection, ...prev]);
        setWeeklyReflection({ delegated: '', shouldHaveDelegated: '', whoStretched: '', needsChallenge: '', askedOrAnswered: '' });
      };

      const updateTeamMember = (id, field, value) => {
        setTeamMembers(prev => prev.map(m => m.id === id ? { ...m, [field]: value } : m));
      };

      const addTeamMember = () => {
        const newId = Math.max(...teamMembers.map(m => m.id), 0) + 1;
        setTeamMembers(prev => [...prev, { id: newId, name: `Team Member ${newId}`, stretchProject: '', delegationLevel: 2, notes: '' }]);
      };

      const delegationLevels = [
        { level: 1, desc: "Look into this, I'll decide", color: 'bg-red-100 text-red-800' },
        { level: 2, desc: "Recommend, I'll approve", color: 'bg-orange-100 text-orange-800' },
        { level: 3, desc: "Decide, tell me before acting", color: 'bg-yellow-100 text-yellow-800' },
        { level: 4, desc: "Decide and act, then tell me", color: 'bg-blue-100 text-blue-800' },
        { level: 5, desc: "Full ownership, no check-in", color: 'bg-green-100 text-green-800' },
      ];

      const mindsetShifts = [
        { from: '"I can do this faster myself"', to: '"If I do this, my team never learns"' },
        { from: '"This is too risky to delegate"', to: '"Risk is how people grow; I\'ll provide guardrails"' },
        { from: '"They\'re not ready"', to: '"They won\'t be ready until I give them the chance"' },
        { from: '"I\'ll just fix this small thing"', to: '"This small thing is a learning opportunity"' },
        { from: '"I need to have all the answers"', to: '"I need to ask the right questions"' },
      ];

      const coachingQuestions = [
        "What options have you considered?",
        "What's your recommendation?",
        "What's the worst that could happen, and how would we recover?",
        "What would you need to feel confident doing this?",
        "What do you think we should do?",
        "Walk me through your reasoning.",
        "What have you tried so far?",
        "What would you do if I weren't available?",
      ];

      const helicopterChecks = [
        { question: "Am I hovering?", detail: "Checking in too frequently" },
        { question: "Am I rescuing?", detail: "Jumping in at first sign of struggle" },
        { question: "Am I controlling?", detail: "Dictating the 'how' instead of the 'what'" },
      ];

      // Setup Screen
      if (!isSetup) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full">
              <div className="text-center mb-6">
                <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Icon name="Key" className="w-8 h-8 text-blue-600" />
                </div>
                <h1 className="text-2xl font-bold text-gray-800">Welcome to Delegation Portal</h1>
                <p className="text-gray-500 mt-2">Connect your GitHub account to sync data across devices</p>
              </div>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    GitHub Personal Access Token
                  </label>
                  <input
                    type="password"
                    value={tokenInput}
                    onChange={(e) => setTokenInput(e.target.value)}
                    placeholder="ghp_xxxxxxxxxxxx"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    onKeyDown={(e) => e.key === 'Enter' && handleSetupSubmit()}
                  />
                  <p className="text-xs text-gray-500 mt-2">
                    Token is stored locally in your browser and only used to access your private Gist.
                  </p>
                </div>
                
                {syncStatus === 'error' && (
                  <div className="p-3 bg-red-50 text-red-700 rounded-lg text-sm">
                    {syncMessage}
                  </div>
                )}
                
                {syncStatus === 'loading' && (
                  <div className="p-3 bg-blue-50 text-blue-700 rounded-lg text-sm flex items-center gap-2">
                    <Icon name="Loader" className="w-4 h-4 animate-spin" />
                    {syncMessage}
                  </div>
                )}
                
                <button
                  onClick={handleSetupSubmit}
                  disabled={!tokenInput.trim() || syncStatus === 'loading'}
                  className="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  Connect & Continue
                </button>
                
                <div className="text-center">
                  <a
                    href="https://github.com/settings/tokens/new?scopes=gist&description=Delegation%20Portal"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-sm text-blue-600 hover:underline inline-flex items-center gap-1"
                  >
                    Need a token? Create one here <Icon name="ExternalLink" className="w-3 h-3" />
                  </a>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Settings Modal
      const renderSettingsModal = () => (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-semibold">Settings</h3>
              <button onClick={() => setShowSettings(false)} className="text-gray-500 hover:text-gray-700">
                <Icon name="X" className="w-5 h-5" />
              </button>
            </div>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">GitHub Token</label>
                <div className="flex items-center gap-2">
                  <input
                    type="password"
                    value={token}
                    readOnly
                    className="flex-1 p-2 border rounded-lg bg-gray-50 text-gray-500"
                  />
                  <Icon name="Check" className="w-5 h-5 text-green-500" />
                </div>
              </div>
              
              {gistId && (
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Gist ID</label>
                  <div className="flex items-center gap-2">
                    <input
                      type="text"
                      value={gistId}
                      readOnly
                      className="flex-1 p-2 border rounded-lg bg-gray-50 text-gray-500 text-sm"
                    />
                    <a
                      href={`https://gist.github.com/${gistId}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="p-2 text-blue-600 hover:text-blue-800"
                    >
                      <Icon name="ExternalLink" className="w-4 h-4" />
                    </a>
                  </div>
                </div>
              )}
              
              <div className="pt-4 border-t">
                <button
                  onClick={handleClearSetup}
                  className="w-full py-2 bg-red-100 text-red-700 rounded-lg font-medium hover:bg-red-200 transition"
                >
                  Disconnect GitHub & Clear Local Data
                </button>
                <p className="text-xs text-gray-500 mt-2 text-center">
                  This will remove your token from this device. Your Gist data will remain on GitHub.
                </p>
              </div>
            </div>
          </div>
        </div>
      );

      // Sync Status Bar
      const renderSyncBar = () => (
        <div className="bg-white border-b px-4 py-2 flex flex-wrap items-center justify-between gap-2">
          <div className="flex items-center gap-4">
            <div className="flex items-center gap-2">
              {hasUnsavedChanges ? (
                <Icon name="CloudOff" className="w-4 h-4 text-amber-500" />
              ) : (
                <Icon name="Cloud" className="w-4 h-4 text-green-500" />
              )}
              <span className="text-sm text-gray-600">
                {hasUnsavedChanges ? 'Unsaved changes' : lastSynced ? `Last synced: ${lastSynced.toLocaleTimeString()}` : 'Not synced yet'}
              </span>
            </div>
            
            {syncStatus !== 'idle' && (
              <span className={`text-sm flex items-center gap-1 ${
                syncStatus === 'error' ? 'text-red-600' : 
                syncStatus === 'success' ? 'text-green-600' : 'text-blue-600'
              }`}>
                {(syncStatus === 'saving' || syncStatus === 'loading') && <Icon name="Loader" className="w-3 h-3 animate-spin" />}
                {syncMessage}
              </span>
            )}
          </div>
          
          <div className="flex items-center gap-2">
            <button
              onClick={loadFromCloud}
              disabled={syncStatus === 'loading' || syncStatus === 'saving'}
              className="flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition disabled:opacity-50"
            >
              <Icon name="Download" className="w-4 h-4" /> Load
            </button>
            <button
              onClick={saveToCloud}
              disabled={syncStatus === 'loading' || syncStatus === 'saving'}
              className={`flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg transition disabled:opacity-50 ${
                hasUnsavedChanges 
                  ? 'bg-blue-600 text-white hover:bg-blue-700' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <Icon name="Upload" className="w-4 h-4" /> Save
            </button>
            <button
              onClick={() => setShowSettings(true)}
              className="p-1.5 text-gray-500 hover:text-gray-700 transition"
            >
              <Icon name="Settings" className="w-4 h-4" />
            </button>
          </div>
        </div>
      );

      const renderDashboard = () => {
        const totalChecked = Object.values(quarterlyChecklist).flatMap(q => q.items).filter(i => i.done).length;
        const totalItems = Object.values(quarterlyChecklist).flatMap(q => q.items).length;
        
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white">
                <div className="flex items-center justify-between">
                  <Icon name="Target" className="w-8 h-8 opacity-80" />
                  <span className="text-3xl font-bold">{totalChecked}/{totalItems}</span>
                </div>
                <p className="mt-2 text-blue-100">Quarterly Goals</p>
              </div>
              <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white">
                <div className="flex items-center justify-between">
                  <Icon name="TrendingUp" className="w-8 h-8 opacity-80" />
                  <span className="text-3xl font-bold">{delegationLog.length}</span>
                </div>
                <p className="mt-2 text-green-100">Tasks Delegated</p>
              </div>
              <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white">
                <div className="flex items-center justify-between">
                  <Icon name="RotateCcw" className="w-8 h-8 opacity-80" />
                  <span className="text-3xl font-bold">{impulseCounter.redirected}</span>
                </div>
                <p className="mt-2 text-purple-100">Impulses Redirected</p>
              </div>
              <div className="bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl p-4 text-white">
                <div className="flex items-center justify-between">
                  <Icon name="Users" className="w-8 h-8 opacity-80" />
                  <span className="text-3xl font-bold">{teamMembers.filter(m => m.stretchProject).length}/{teamMembers.length}</span>
                </div>
                <p className="mt-2 text-amber-100">Team w/ Stretch Projects</p>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow-sm border p-6">
              <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
                <Icon name="AlertTriangle" className="w-5 h-5 text-amber-500" />
                5-Minute Rule Tracker
              </h3>
              <p className="text-gray-600 mb-4">When you feel the impulse to do something yourself, wait 5 minutes and ask: "Who could do this?"</p>
              <div className="flex flex-wrap gap-4 items-center">
                <button
                  onClick={() => setImpulseCounter(prev => ({ ...prev, caught: prev.caught + 1, redirected: prev.redirected + 1 }))}
                  className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                >
                  ✓ Caught & Redirected
                </button>
                <button
                  onClick={() => setImpulseCounter(prev => ({ ...prev, caught: prev.caught + 1 }))}
                  className="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition"
                >
                  ⚠ Caught (did it anyway)
                </button>
                <div className="text-gray-500">
                  Success rate: {impulseCounter.caught > 0 ? Math.round((impulseCounter.redirected / impulseCounter.caught) * 100) : 0}%
                </div>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow-sm border p-6">
              <h3 className="text-lg font-semibold mb-4">Quick Mindset Check</h3>
              <div className="grid gap-3">
                {mindsetShifts.slice(0, 3).map((shift, idx) => (
                  <div key={idx} className="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">
                    <span className="text-red-500 line-through text-sm flex-1">{shift.from}</span>
                    <Icon name="ChevronRight" className="w-4 h-4 text-gray-400 flex-shrink-0" />
                    <span className="text-green-600 font-medium text-sm flex-1">{shift.to}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      };

      const renderWeekly = () => (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Icon name="Calendar" className="w-5 h-5 text-blue-500" />
              Weekly Reflection (5 minutes every Friday)
            </h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">What did I delegate that I wanted to do myself?</label>
                <textarea
                  value={weeklyReflection.delegated}
                  onChange={(e) => setWeeklyReflection(prev => ({ ...prev, delegated: e.target.value }))}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  rows={2}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">What did I do that I should have delegated?</label>
                <textarea
                  value={weeklyReflection.shouldHaveDelegated}
                  onChange={(e) => setWeeklyReflection(prev => ({ ...prev, shouldHaveDelegated: e.target.value }))}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  rows={2}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Who on my team stretched this week?</label>
                <textarea
                  value={weeklyReflection.whoStretched}
                  onChange={(e) => setWeeklyReflection(prev => ({ ...prev, whoStretched: e.target.value }))}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  rows={2}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Who needs more challenge?</label>
                <textarea
                  value={weeklyReflection.needsChallenge}
                  onChange={(e) => setWeeklyReflection(prev => ({ ...prev, needsChallenge: e.target.value }))}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  rows={2}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Did I answer questions or ask questions this week?</label>
                <textarea
                  value={weeklyReflection.askedOrAnswered}
                  onChange={(e) => setWeeklyReflection(prev => ({ ...prev, askedOrAnswered: e.target.value }))}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  rows={2}
                />
              </div>
              <button
                onClick={saveWeeklyReflection}
                className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
              >
                <Icon name="Save" className="w-4 h-4" /> Save Reflection
              </button>
            </div>
          </div>

          {savedReflections.length > 0 && (
            <div className="bg-white rounded-xl shadow-sm border p-6">
              <h3 className="text-lg font-semibold mb-4">Past Reflections</h3>
              <div className="space-y-4 max-h-96 overflow-y-auto">
                {savedReflections.map(ref => (
                  <div key={ref.id} className="p-4 bg-gray-50 rounded-lg">
                    <div className="flex justify-between items-center mb-2">
                      <span className="font-medium">{ref.date}</span>
                      <button
                        onClick={() => setSavedReflections(prev => prev.filter(r => r.id !== ref.id))}
                        className="text-red-500 hover:text-red-700"
                      >
                        <Icon name="Trash2" className="w-4 h-4" />
                      </button>
                    </div>
                    <div className="text-sm text-gray-600 space-y-1">
                      {ref.delegated && <p><strong>Delegated:</strong> {ref.delegated}</p>}
                      {ref.shouldHaveDelegated && <p><strong>Should have delegated:</strong> {ref.shouldHaveDelegated}</p>}
                      {ref.whoStretched && <p><strong>Who stretched:</strong> {ref.whoStretched}</p>}
                      {ref.needsChallenge && <p><strong>Needs challenge:</strong> {ref.needsChallenge}</p>}
                      {ref.askedOrAnswered && <p><strong>Asked/Answered:</strong> {ref.askedOrAnswered}</p>}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Icon name="AlertTriangle" className="w-5 h-5 text-amber-500" />
              Helicopter Manager Test
            </h3>
            <div className="space-y-3">
              {helicopterChecks.map((check, idx) => (
                <div key={idx} className="p-4 bg-amber-50 rounded-lg border border-amber-200">
                  <p className="font-medium text-amber-800">{check.question}</p>
                  <p className="text-sm text-amber-600">{check.detail}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

      const renderQuarterly = () => (
        <div className="space-y-6">
          <div className="flex gap-2 mb-4 flex-wrap">
            {['Q1', 'Q2', 'Q3', 'Q4'].map(q => (
              <button
                key={q}
                onClick={() => setCurrentQuarter(q)}
                className={`px-4 py-2 rounded-lg font-medium transition ${
                  currentQuarter === q
                    ? 'bg-blue-500 text-white'
                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                }`}
              >
                {q}
              </button>
            ))}
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4">
              {currentQuarter} Goals
              <span className="ml-2 text-sm font-normal text-gray-500">
                ({quarterlyChecklist[currentQuarter].items.filter(i => i.done).length}/{quarterlyChecklist[currentQuarter].items.length} complete)
              </span>
            </h3>
            <div className="space-y-3">
              {quarterlyChecklist[currentQuarter].items.map(item => (
                <div
                  key={item.id}
                  onClick={() => toggleChecklistItem(currentQuarter, item.id)}
                  className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition ${
                    item.done ? 'bg-green-50 border border-green-200' : 'bg-gray-50 hover:bg-gray-100'
                  }`}
                >
                  {item.done ? (
                    <Icon name="CheckCircle" className="w-6 h-6 text-green-500 flex-shrink-0" />
                  ) : (
                    <Icon name="Circle" className="w-6 h-6 text-gray-300 flex-shrink-0" />
                  )}
                  <span className={item.done ? 'line-through text-gray-500' : ''}>{item.text}</span>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4">Quarterly Focus Areas</h3>
            <div className="grid gap-4">
              {currentQuarter === 'Q1' && (
                <div className="p-4 bg-blue-50 rounded-lg">
                  <h4 className="font-medium text-blue-800">Foundation Building</h4>
                  <p className="text-sm text-blue-600 mt-1">Identify delegation opportunities and start building the habit. Create your delegation inventory and assign stretch projects.</p>
                </div>
              )}
              {currentQuarter === 'Q2' && (
                <div className="p-4 bg-green-50 rounded-lg">
                  <h4 className="font-medium text-green-800">Building Capability</h4>
                  <p className="text-sm text-green-600 mt-1">Actively grow team members through challenging assignments. Assign ownership, not tasks. Coach with questions.</p>
                </div>
              )}
              {currentQuarter === 'Q3' && (
                <div className="p-4 bg-purple-50 rounded-lg">
                  <h4 className="font-medium text-purple-800">Scaling Impact</h4>
                  <p className="text-sm text-purple-600 mt-1">Team operates more independently. Delegate visible initiatives. Step back from daily decisions.</p>
                </div>
              )}
              {currentQuarter === 'Q4' && (
                <div className="p-4 bg-amber-50 rounded-lg">
                  <h4 className="font-medium text-amber-800">Reinforcement & Reflection</h4>
                  <p className="text-sm text-amber-600 mt-1">Consolidate gains and prepare for next year. Gather feedback, celebrate wins, plan ahead.</p>
                </div>
              )}
            </div>
          </div>
        </div>
      );

      const renderTeam = () => (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-sm border p-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-semibold flex items-center gap-2">
                <Icon name="Users" className="w-5 h-5 text-blue-500" />
                Team Member Tracking
              </h3>
              <button
                onClick={addTeamMember}
                className="px-3 py-1 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition"
              >
                + Add Member
              </button>
            </div>
            <div className="space-y-4">
              {teamMembers.map(member => (
                <div key={member.id} className="p-4 bg-gray-50 rounded-lg">
                  <div className="grid gap-3">
                    <div className="flex items-center gap-2">
                      <input
                        type="text"
                        value={member.name}
                        onChange={(e) => updateTeamMember(member.id, 'name', e.target.value)}
                        className="flex-1 font-medium p-2 border rounded-lg"
                        placeholder="Team member name"
                      />
                      <button
                        onClick={() => setTeamMembers(prev => prev.filter(m => m.id !== member.id))}
                        className="p-2 text-red-500 hover:text-red-700"
                      >
                        <Icon name="Trash2" className="w-4 h-4" />
                      </button>
                    </div>
                    <div>
                      <label className="block text-sm text-gray-600 mb-1">Stretch Project</label>
                      <input
                        type="text"
                        value={member.stretchProject}
                        onChange={(e) => updateTeamMember(member.id, 'stretchProject', e.target.value)}
                        className="w-full p-2 border rounded-lg"
                        placeholder="Current stretch assignment..."
                      />
                    </div>
                    <div>
                      <label className="block text-sm text-gray-600 mb-1">Current Delegation Level</label>
                      <select
                        value={member.delegationLevel}
                        onChange={(e) => updateTeamMember(member.id, 'delegationLevel', parseInt(e.target.value))}
                        className="w-full p-2 border rounded-lg"
                      >
                        {delegationLevels.map(dl => (
                          <option key={dl.level} value={dl.level}>Level {dl.level}: {dl.desc}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm text-gray-600 mb-1">Development Notes</label>
                      <textarea
                        value={member.notes}
                        onChange={(e) => updateTeamMember(member.id, 'notes', e.target.value)}
                        className="w-full p-2 border rounded-lg"
                        rows={2}
                        placeholder="Growth areas, progress notes..."
                      />
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4">Delegation Levels Reference</h3>
            <div className="space-y-2">
              {delegationLevels.map(dl => (
                <div key={dl.level} className={`p-3 rounded-lg ${dl.color}`}>
                  <span className="font-medium">Level {dl.level}:</span> {dl.desc}
                </div>
              ))}
            </div>
            <p className="mt-4 text-sm text-gray-500">Goal: Move team members up these levels over time.</p>
          </div>
        </div>
      );

      const renderTools = () => (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Icon name="MessageSquare" className="w-5 h-5 text-green-500" />
              Coaching Questions (Instead of Answers)
            </h3>
            <div className="grid gap-2">
              {coachingQuestions.map((q, idx) => (
                <div key={idx} className="p-3 bg-green-50 rounded-lg text-green-800 border border-green-200">
                  "{q}"
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Icon name="Brain" className="w-5 h-5 text-purple-500" />
              Mindset Shifts
            </h3>
            <div className="space-y-3">
              {mindsetShifts.map((shift, idx) => (
                <div key={idx} className="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">
                  <span className="text-red-500 line-through text-sm flex-1">{shift.from}</span>
                  <Icon name="ChevronRight" className="w-4 h-4 text-gray-400 flex-shrink-0" />
                  <span className="text-green-600 font-medium text-sm flex-1">{shift.to}</span>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4">Scripts for Common Situations</h3>
            <div className="space-y-4">
              <div className="p-4 bg-blue-50 rounded-lg">
                <h4 className="font-medium text-blue-800 mb-2">When tempted to do it yourself:</h4>
                <p className="text-blue-700 italic">"I could jump in and do this, but I think this would be a great opportunity for [name]. Let me see if they can take this on."</p>
              </div>
              <div className="p-4 bg-green-50 rounded-lg">
                <h4 className="font-medium text-green-800 mb-2">When assigning a stretch project:</h4>
                <p className="text-green-700 italic">"I want to give you ownership of [project]. This is going to be challenging—it's meant to be. I'm not expecting perfection; I'm expecting you to grow through this."</p>
              </div>
              <div className="p-4 bg-amber-50 rounded-lg">
                <h4 className="font-medium text-amber-800 mb-2">When someone asks for the answer:</h4>
                <p className="text-amber-700 italic">"What do you think we should do? ... Okay, walk me through your reasoning. ... That sounds reasonable—go with it."</p>
              </div>
              <div className="p-4 bg-purple-50 rounded-lg">
                <h4 className="font-medium text-purple-800 mb-2">When it's not done your way:</h4>
                <p className="text-purple-700 italic">"Is it wrong, or is it just different? If it achieves the goal, let it stand."</p>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Icon name="Award" className="w-5 h-5 text-amber-500" />
              The 70% Rule
            </h3>
            <div className="p-4 bg-amber-50 rounded-lg border border-amber-200">
              <p className="text-amber-800 font-medium">If someone can do a task at least 70% as well as you, delegate it.</p>
              <p className="text-amber-600 mt-2 text-sm">The 30% gap is the cost of developing your team—and it closes over time.</p>
            </div>
          </div>
        </div>
      );

      const renderDelegationLog = () => (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4">Log a Delegation</h3>
            <div className="grid gap-3">
              <input
                type="text"
                value={newDelegation.task}
                onChange={(e) => setNewDelegation(prev => ({ ...prev, task: e.target.value }))}
                className="p-3 border rounded-lg"
                placeholder="Task/Project delegated..."
              />
              <input
                type="text"
                value={newDelegation.person}
                onChange={(e) => setNewDelegation(prev => ({ ...prev, person: e.target.value }))}
                className="p-3 border rounded-lg"
                placeholder="Delegated to..."
              />
              <div className="flex gap-3 flex-wrap">
                <select
                  value={newDelegation.level}
                  onChange={(e) => setNewDelegation(prev => ({ ...prev, level: e.target.value }))}
                  className="flex-1 min-w-32 p-3 border rounded-lg"
                >
                  {delegationLevels.map(dl => (
                    <option key={dl.level} value={dl.level}>Level {dl.level}</option>
                  ))}
                </select>
                <input
                  type="date"
                  value={newDelegation.date}
                  onChange={(e) => setNewDelegation(prev => ({ ...prev, date: e.target.value }))}
                  className="p-3 border rounded-lg"
                />
              </div>
              <button
                onClick={addDelegation}
                className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
              >
                + Add to Log
              </button>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border p-6">
            <h3 className="text-lg font-semibold mb-4">Delegation History</h3>
            {delegationLog.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No delegations logged yet. Start tracking!</p>
            ) : (
              <div className="space-y-3">
                {delegationLog.slice().reverse().map(item => (
                  <div key={item.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div>
                      <p className="font-medium">{item.task}</p>
                      <p className="text-sm text-gray-500">To: {item.person} • Level {item.level} • {item.date}</p>
                    </div>
                    <button
                      onClick={() => setDelegationLog(prev => prev.filter(d => d.id !== item.id))}
                      className="text-red-500 hover:text-red-700"
                    >
                      <Icon name="Trash2" className="w-4 h-4" />
                    </button>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );

      const tabs = [
        { id: 'dashboard', label: 'Dashboard', icon: 'Target' },
        { id: 'weekly', label: 'Weekly', icon: 'Calendar' },
        { id: 'quarterly', label: 'Quarterly', icon: 'TrendingUp' },
        { id: 'team', label: 'Team', icon: 'Users' },
        { id: 'log', label: 'Log', icon: 'CheckCircle' },
        { id: 'tools', label: 'Tools', icon: 'Brain' },
      ];

      return (
        <div className="min-h-screen bg-gray-100">
          {showSettings && renderSettingsModal()}
          
          <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6">
            <h1 className="text-2xl font-bold">Delegation & Team Growth Portal</h1>
            <p className="text-blue-100 mt-1">Building a team that thrives without you</p>
          </div>

          {renderSyncBar()}

          <div className="border-b bg-white sticky top-0 z-10">
            <div className="flex overflow-x-auto">
              {tabs.map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center gap-2 px-6 py-4 font-medium border-b-2 transition whitespace-nowrap ${
                    activeTab === tab.id
                      ? 'border-blue-500 text-blue-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700'
                  }`}
                >
                  <Icon name={tab.icon} className="w-4 h-4" />
                  {tab.label}
                </button>
              ))}
            </div>
          </div>

          <div className="p-6 max-w-5xl mx-auto">
            {activeTab === 'dashboard' && renderDashboard()}
            {activeTab === 'weekly' && renderWeekly()}
            {activeTab === 'quarterly' && renderQuarterly()}
            {activeTab === 'team' && renderTeam()}
            {activeTab === 'log' && renderDelegationLog()}
            {activeTab === 'tools' && renderTools()}
          </div>

          <div className="bg-gray-800 text-gray-400 p-4 text-center text-sm">
            <p>"Delegation isn't about giving away work you don't want to do. It's about giving away work you <em>do</em> want to do, because someone else needs the opportunity more than you need the satisfaction."</p>
          </div>
        </div>
      );
    }

    ReactDOM.render(<DelegationPortal />, document.getElementById('root'));
  </script>
</body>
</html>
